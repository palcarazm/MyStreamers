{"version":3,"sources":["config.js","main.js"],"names":["verifyDB","$","on","e","preventDefault","this","find","attr","loadToggle","callAPIverbose","FormData","filter","length","removeClass","addClass","width","configAdmin","validAdminuserForm","validPass","validPassAdminuserForm","validEmail","validEmailAdminuserForm","closest","removeAttr","password","passwordRepeat","parent","remove","val","append","text","checkPasswordStrength","String","trim","email","validateEmail","togglePassword","hasClass","RegExp","test","toLowerCase","currentURL"],"mappings":"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","file":"admin.min.js","sourcesContent":["/** Configurar base de datos\r\n *\r\n */\r\nfunction verifyDB() {\r\n  $(\"#verifyDB form\").on(\"submit\", function (e) {\r\n    e.preventDefault();\r\n    $(this).find('button[type=\"submit\"]').attr(\"disabled\", true);\r\n    $(this).loadToggle();\r\n    callAPIverbose(\r\n      $(this).attr(\"action\"),\r\n      $(this).attr(\"method\"),\r\n      new FormData(this),\r\n      $(this).find(\"input,textarea,select\").filter(\"[required]\").length,\r\n      function () {\r\n        $(\"#verifyDB form\").loadToggle();\r\n        $(\"#verifyDB.step\").removeClass(\"current\").addClass(\"done\");\r\n        $(\"#verifyDB.step h2\").addClass(\"text-success\");\r\n        $(\"#configAdmin.step \").removeClass(\"todo\").addClass(\"current\");\r\n        $(\"#progreso\").width(\"33%\");\r\n      },\r\n      function () {\r\n        $(\"#verifyDB form\").loadToggle();\r\n        $(\"#verifyDB form\")\r\n          .find('button[type=\"submit\"]')\r\n          .attr(\"disabled\", false);\r\n      }\r\n    );\r\n  });\r\n}\r\n/** Configurar administrador\r\n *\r\n */\r\nfunction configAdmin() {\r\n  $(\"#configAdmin form\").on(\"submit\", function (e) {\r\n    e.preventDefault();\r\n    $(this).find('button[type=\"submit\"]').attr(\"disabled\", true);\r\n    $(this).loadToggle();\r\n    callAPIverbose(\r\n      $(this).attr(\"action\"),\r\n      $(this).attr(\"method\"),\r\n      new FormData(this),\r\n      $(this).find(\"input,textarea,select\").filter(\"[required]\").length,\r\n      function () {\r\n        $(\"#configAdmin form\").loadToggle();\r\n        $(\"#configAdmin.step\").removeClass(\"current\").addClass(\"done\");\r\n        $(\"#configAdmin.step h2\").addClass(\"text-success\");\r\n        $(\"#siteConfig.step \").removeClass(\"todo\").addClass(\"current\");\r\n        $(\"#progreso\").width(\"67%\");\r\n      },\r\n      function () {\r\n        $(\"#configAdmin form\").loadToggle();\r\n        $(\"#configAdmin form\")\r\n          .find('button[type=\"submit\"]')\r\n          .attr(\"disabled\", false);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\n/**\r\n * Valida el formulario de configuración de administrador\r\n */\r\nfunction validAdminuserForm() {\r\n  $(\r\n    \"#configAdmin form #pass2 , #configAdmin form #pass , #configAdmin form #email\"\r\n  ).on(\"input keyup keypress blur change\", function () {\r\n    const validPass = validPassAdminuserForm();\r\n    const validEmail = validEmailAdminuserForm();\r\n    if (validPass && validEmail) {\r\n      $(this)\r\n        .closest(\"form\")\r\n        .find('button[type=\"submit\"]')\r\n        .removeAttr(\"disabled\");\r\n    } else {\r\n      $(this)\r\n        .closest(\"form\")\r\n        .find('button[type=\"submit\"]')\r\n        .attr(\"disabled\", \"disabled\");\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Valida las contraseñas del Formulario de configuración de administrador\r\n * @returns bool Validación superada (Si/No)\r\n */\r\nfunction validPassAdminuserForm() {\r\n  const password = $(\"#configAdmin form #pass\");\r\n  const passwordRepeat = $(\"#configAdmin form #pass2\");\r\n  password.parent().find(\".invalid-feedback\").remove();\r\n  passwordRepeat.parent().find(\".invalid-feedback\").remove();\r\n  if (passwordRepeat.val() != password.val()) {\r\n    password\r\n      .parent()\r\n      .append(\r\n        $(\"<div></div>\")\r\n          .addClass(\"invalid-feedback\")\r\n          .text(\"Las contraseñas no coinciden\")\r\n      );\r\n    passwordRepeat\r\n      .parent()\r\n      .append(\r\n        $(\"<div></div>\")\r\n          .addClass(\"invalid-feedback\")\r\n          .text(\"Las contraseñas no coinciden\")\r\n      );\r\n    passwordRepeat.addClass(\"is-invalid\").removeClass(\"is-valid\");\r\n    password.addClass(\"is-invalid\").removeClass(\"is-valid\");\r\n    return false;\r\n  } else if (!checkPasswordStrength(String(password.val()).trim())) {\r\n    password.addClass(\"is-invalid\").removeClass(\"is-valid\");\r\n    password\r\n      .parent()\r\n      .append(\r\n        $(\"<div></div>\")\r\n          .addClass(\"invalid-feedback\")\r\n          .text(\r\n            \"La contraseña debe contener al menos una minúscula, una mayúscula, un número, un carácter especial y ser de almenos 8 carácteres\"\r\n          )\r\n      );\r\n    return false;\r\n  } else {\r\n    passwordRepeat.removeClass(\"is-invalid\").addClass(\"is-valid\");\r\n    password.removeClass(\"is-invalid\").addClass(\"is-valid\");\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * Valida el email del Formulario de configuración de afministrador\r\n * @returns bool Validación superada (Si/No)\r\n */\r\nfunction validEmailAdminuserForm() {\r\n  const email = $(\"#configAdmin form #email\");\r\n  email.parent().find(\".invalid-feedback\").remove();\r\n  if (validateEmail(String(email.val()).trim())) {\r\n    email.removeClass(\"is-invalid\").addClass(\"is-valid\");\r\n    return true;\r\n  } else {\r\n    email.addClass(\"is-invalid\").removeClass(\"is-valid\");\r\n    email\r\n      .parent()\r\n      .append(\r\n        $(\"<div></div>\")\r\n          .addClass(\"invalid-feedback\")\r\n          .text(\r\n            \"El correo electrónico debe ser válido\"\r\n          )\r\n      );\r\n    return false;\r\n  }\r\n}\r\n","$(function () {\r\n  switch (currentURL()) {\r\n    case \"/config\":\r\n      togglePassword();\r\n      verifyDB();\r\n      configAdmin();\r\n      validAdminuserForm();\r\n      break;\r\n\r\n    default:\r\n      break;\r\n  }\r\n});\r\n\r\n// Funciones\r\n/**\r\n * Muestra y oculta la contraseña al apretar un boton\r\n */\r\nfunction togglePassword() {\r\n  $(\".toggle-password\").on(\"click\", function () {\r\n    if ($(this).find(\"i\").hasClass(\"fa-eye\")) {\r\n      $(this).closest(\".input-group\").find(\"input\").attr(\"type\", \"text\");\r\n      $(this).find(\"i\").addClass(\"fa-eye-slash\").removeClass(\"fa-eye\");\r\n    } else {\r\n      $(this).closest(\".input-group\").find(\"input\").attr(\"type\", \"password\");\r\n      $(this).find(\"i\").addClass(\"fa-eye\").removeClass(\"fa-eye-slash\");\r\n    }\r\n  });\r\n}\r\n/**\r\n * Compurueba la seguridad de la contraseña\r\n * @param {String} password \r\n * @returns cumple las reglas de seguridad (Si/No)\r\n */\r\nfunction checkPasswordStrength(password) {\r\n  return new RegExp(\r\n    \"(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])(?=.{8,})\"\r\n  ).test(password);\r\n}\r\n/**\r\n * Valida que el texto inproducido es un email\r\n * @param {String} email \r\n * @returns es un email (Si/No)\r\n */\r\nfunction validateEmail(email) {\r\n  const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n  return re.test(String(email).toLowerCase());\r\n}"]}